<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MonitorAQ • Campo Maior (PI)</title>

  <!-- Bootstrap CSS (CDN) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <link rel="stylesheet" href="style.css">
</head>
<body class="bg-light">

  <nav class="navbar navbar-expand-lg navbar-dark header-gradient sticky-top shadow-sm">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold" href="#">
        <i class="bi bi-cloud-haze2-fill"></i> MonitorAQ • Campo Maior, PI
      </a>
      <div class="d-flex gap-2">
        <span id="statusIndicator" class="badge align-self-center bg-secondary">Conectando...</span>
        <button id="toggleStreamBtn" class="btn btn-outline-light btn-sm">Parar stream</button>
      </div>
    </div>
  </nav>

  <main class="container my-4">
    <div class="row g-3">
      <div class="col-lg-8">
        <div class="card shadow-sm">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h5 class="card-title mb-0">Leituras em tempo real — Campo Maior, PI</h5>
              <small class="text-muted" id="lastUpdate">Última atualização: —</small>
            </div>
            <canvas id="aqChart" height="140"></canvas>
          </div>
        </div>

        <div class="card mt-3 shadow-sm">
          <div class="card-body">
            <h6 class="mb-3">Histórico recente</h6>
            <div class="table-responsive">
              <table class="table table-sm table-hover" id="readingsTable">
                <thead class="table-light">
                  <tr>
                    <th>Horário</th>
                    <th>Sensor</th>
                    <th>Local</th>
                    <th>PM2.5</th>
                    <th>PM10</th>
                    <th>NO₂</th>
                    <th>AQI (PM2.5)</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
            <div class="d-flex gap-2 mt-2">
              <button id="btnAddSensor" class="btn btn-primary btn-sm">Adicionar sensor (local)</button>
              <button id="btnClear" class="btn btn-outline-secondary btn-sm">Limpar dados</button>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-4">
        <div class="card mb-3 shadow-sm animated-card">
          <div class="card-body">
            <h6 class="card-title">AQI Atual (PM2.5) médio</h6>
            <div class="d-flex align-items-center justify-content-between">
              <div>
                <h2 id="avgAQI" class="display-6 mb-0">—</h2>
                <small id="aqCategory" class="text-muted">—</small>
              </div>
              <div><i class="bi bi-speedometer2 fs-1"></i></div>
            </div>
          </div>
        </div>

        <div class="card mb-3 shadow-sm animated-card">
          <div class="card-body">
            <h6 class="card-title">Previsão (próxima leitura)</h6>
            <p class="mb-1 small text-muted">Modelo: regressão linear sobre últimos PM2.5</p>
            <div class="d-flex align-items-center justify-content-between">
              <div>
                <h3 id="predPM25" class="mb-0">— µg/m³</h3>
                <small id="predAQI" class="text-muted">AQI: —</small>
              </div>
              <div><i class="bi bi-graph-up-arrow fs-2"></i></div>
            </div>
            <div class="mt-3"><small class="text-muted">Treino com <span id="trainCount">0</span> pontos</small></div>
          </div>
        </div>

        <div class="card shadow-sm animated-card">
          <div class="card-body">
            <h6 class="card-title">Sensores</h6>
            <ul id="sensorList" class="list-group list-group-flush small"></ul>
          </div>
        </div>

        <div class="mt-3 text-center"><small class="text-muted">Dados gravados no Supabase (quando disponível).</small></div>
      </div>
    </div>
  </main>

  <footer class="text-center py-3 small text-muted">
    © MonitorAQ — Demo • Campo Maior (PI)
  </footer>

  <!-- Supabase JS (UMD) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>

  <!-- Inicialização Supabase - substitua os placeholders abaixo -->
  <script>
    // === SUBSTITUA ESTES VALORES PELO SEU PROJETO ===
    const SUPABASE_URL = "https://SEU-PROJETO.supabase.co";
    const SUPABASE_ANON_KEY = "SEU_ANON_KEY_AQUI";
    // ===============================================
    // Inicializa cliente Supabase e variáveis padrão:
    window.supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    window.DEFAULT_CITY = "Campo Maior";
    window.DEFAULT_STATE = "PI";
    // Controle para habilitar gravação no Supabase (true = envia leituras)
    window.USE_SUPABASE = true;
  </script>

  <!-- Bootstrap JS bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script src="script.js"></script>
</body>
</html>
